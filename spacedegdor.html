<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Space Dodger ‚Äî Game dengan Peringkat</title>
  <style>
    :root{ --bg:#0b1020; --panel:#0f1724; --accent:#ff6b6b; --muted:#9aa4b2 }
    html,body{height:100%;margin:0;font-family:system-ui}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg),#071226);color:#fff}
    .wrap{width:100%;max-width:900px;padding:20px}
    .card{background:rgba(255,255,255,0.03);border-radius:12px;padding:14px}
    header{display:flex;align-items:center;gap:12px}
    header h1{font-size:20px;margin:0}
    .meta{color:var(--muted);font-size:13px}
    canvas{width:100%;height:60vh;background:#020612;border-radius:10px}
    .controls{display:flex;gap:8px;margin-top:10px}
    .btn{padding:8px 12px;border-radius:8px;background:#222;color:#fff;border:none;cursor:pointer}
    .btn.primary{background:var(--accent)}

    .mobile-controls{display:flex;gap:6px;margin-top:10px}
    .touchbtn{flex:1;padding:14px;border-radius:8px;background:#333;text-align:center}

    .leaderboard{
      margin-top:12px;
      padding:10px;
      border-radius:10px;
      background:rgba(255,255,255,0.05);
      font-size:13px;
    }
    .leaderboard h3{
      margin:0 0 6px;
      font-size:14px;
      color:#ffd700;
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <header>
      <h1>üöÄ Space Dodger</h1>
      <div class="meta">Hindari meteor & raih skor tertinggi!</div>
      <div style="margin-left:auto">
        Skor: <span id="score">0</span> | High: <span id="best">0</span>
      </div>
    </header>

    <canvas id="gameCanvas" width="800" height="500"></canvas>

    <div class="controls">
      <button class="btn primary" id="startBtn">Mulai</button>
      <button class="btn" id="pauseBtn">Pause</button>
      <button class="btn" id="restartBtn">Restart</button>
    </div>

    <div class="mobile-controls">
      <div id="leftTouch" class="touchbtn">‚óÄ</div>
      <div id="rightTouch" class="touchbtn">‚ñ∂</div>
    </div>

    <div class="leaderboard">
      <h3>üèÜ Peringkat Top 5</h3>
      <ol id="rankList"></ol>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = { x: 0.5, y: 0.85, w: 40, h: 20, vx: 0 };
let obstacles = [];
let lastTime = 0;
let spawnTimer = 0;
let spawnInterval = 900;
let score = 0;
let best = parseInt(localStorage.getItem('sd_best') || 0);
let rankings = JSON.parse(localStorage.getItem('sd_ranking') || "[]");

let running = false;
let paused = false;

const scoreEl = document.getElementById("score");
const bestEl = document.getElementById("best");
const rankList = document.getElementById("rankList");

bestEl.textContent = best;

function resetGame(){
  obstacles=[];
  score=0;
  spawnInterval=900;
  player.x=0.5;
}

function startGame(){
  resetGame();
  running=true;
  paused=false;
  lastTime=performance.now();
  requestAnimationFrame(loop);
}

function updateRanking(finalScore){
  rankings.push(finalScore);
  rankings.sort((a,b)=>b-a);
  rankings=rankings.slice(0,5);
  localStorage.setItem("sd_ranking",JSON.stringify(rankings));
  renderRanking();
}

function renderRanking(){
  rankList.innerHTML="";
  rankings.forEach(s=>{
    const li=document.createElement("li");
    li.textContent="Skor "+s;
    rankList.appendChild(li);
  });
}

const keys={};
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

function spawnObstacle(){
  obstacles.push({
    x:Math.random()*canvas.width,
    y:-20,
    r:10+Math.random()*20,
    vy:100+score*0.3
  });
}

function loop(t){
  if(!running) return;
  const dt=t-lastTime;
  lastTime=t;

  if(!paused){
    let dir=0;
    if(keys.ArrowLeft) dir=-1;
    if(keys.ArrowRight) dir=1;
    player.x+=dir*dt*0.3;
    player.x=Math.max(0,Math.min(canvas.width,player.x));

    spawnTimer+=dt;
    if(spawnTimer>spawnInterval){
      spawnObstacle();
      spawnTimer=0;
    }

    obstacles.forEach(o=>{
      o.y+=o.vy*dt/1000;
      if(Math.abs(o.x-player.x)<20 && Math.abs(o.y-player.y*canvas.height)<20){
        running=false;
        const finalScore=Math.floor(score);
        if(finalScore>best){
          best=finalScore;
          localStorage.setItem("sd_best",best);
        }
        updateRanking(finalScore);
      }
    });

    score+=dt*0.03;
    scoreEl.textContent=Math.floor(score);
    bestEl.textContent=best;
  }

  draw();
  requestAnimationFrame(loop);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="cyan";
  ctx.fillRect(player.x,player.y*canvas.height,player.w,player.h);
  ctx.fillStyle="orange";
  obstacles.forEach(o=>{
    ctx.beginPath();
    ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
    ctx.fill();
  });
}

document.getElementById("startBtn").onclick=startGame;
document.getElementById("restartBtn").onclick=startGame;
document.getElementById("pauseBtn").onclick=()=>paused=!paused;

renderRanking();
</script>
</body>
</html>
